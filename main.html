<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mini Google Agenda Elegan</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<!-- LOGIN -->
<div id="loginDiv">
  <h2>Login</h2>
  <input type="password" id="passwordInput" placeholder="Masukkan password">
  <button onclick="checkPassword()">Login</button>
  <p id="loginMsg"></p>
</div>

<!-- DASHBOARD -->
<div id="mainDiv" style="display:none;">
  <div class="container">

    <!-- PILIH TANGGAL -->
    <div class="card col-12">
      <h3>ğŸ“… Pilih Tanggal</h3>
      <input type="date" id="datePicker">
      <button onclick="loadDate()">Load Tanggal</button>
    </div>

    <!-- AGENDA HARI INI -->
    <div class="card col-12">
      <h3>Agenda Hari Ini</h3>
      <div id="agendaSlots"></div>
      <button onclick="addSlot()">â• Tambah Slot Agenda</button>
    </div>

  </div>
</div>

<script>
// ===== LOGIN =====
const PASSWORD = "Uky@2026!aman";
function checkPassword() {
  const val = document.getElementById("passwordInput").value;
  if(val===PASSWORD){
    document.getElementById("loginDiv").style.display="none";
    document.getElementById("mainDiv").style.display="block";
  } else {
    document.getElementById("loginMsg").innerText="Password salah!";
  }
}

// ===== IndexedDB SETUP =====
let db;
const request = indexedDB.open("MiniAgendaDB", 1);

request.onupgradeneeded = (e)=>{
  db = e.target.result;
  const store = db.createObjectStore("agendaSlots", { keyPath: "id", autoIncrement:true });
  store.createIndex("date", "date", { unique:false });
};

request.onsuccess = (e)=>{
  db = e.target.result;
  console.log("DB siap");
};

request.onerror = (e)=>{ console.error("DB error", e); };

// ===== CURRENT DATE =====
let currentDate = null;

function loadDate(){
  const d = document.getElementById("datePicker").value;
  if(!d) return alert("Pilih tanggal dulu!");
  currentDate = d;
  renderSlots();
}

// ===== RENDER SLOT =====
function renderSlots(){
  if(!currentDate) return;
  const container = document.getElementById("agendaSlots");
  container.innerHTML="";
  const tx = db.transaction("agendaSlots","readonly");
  const store = tx.objectStore("agendaSlots");
  const index = store.index("date");
  const request = index.getAll(currentDate);

  request.onsuccess = ()=>{
    const slots = request.result;
    slots.forEach(slot=>{
      createSlotElement(slot);
    });
  };
}

// ===== CREATE SLOT ELEMENT =====
function createSlotElement(slotData){
  const container = document.getElementById("agendaSlots");
  const div = document.createElement("div");
  div.className="slot";

  div.innerHTML=`
    <input type="text" placeholder="Judul Kegiatan" value="${slotData.title || ''}" class="slotTitle">
    <textarea placeholder="Catatan / Deskripsi">${slotData.notes || ''}</textarea>
    <input type="time" value="${slotData.time || ''}" class="slotTime">
    <button class="saveBtn">ğŸ’¾ Simpan Slot</button>
    <button class="deleteBtn">âŒ Hapus Slot</button>
  `;

  // AUTO EXPAND TEXTAREA
  const textarea = div.querySelector("textarea");
  textarea.addEventListener("input", e=>{
    e.target.style.height = "auto";
    e.target.style.height = (e.target.scrollHeight) + "px";
  });
  textarea.style.height = (textarea.scrollHeight)+"px";

  // SAVE BUTTON
  div.querySelector(".saveBtn").onclick = ()=>{
    const title = div.querySelector(".slotTitle").value;
    const notes = div.querySelector("textarea").value;
    const time = div.querySelector(".slotTime").value;
    saveSlot({id:slotData.id, date:currentDate, title, notes, time});
  };

  // DELETE BUTTON
  div.querySelector(".deleteBtn").onclick = ()=>{
    const tx = db.transaction("agendaSlots","readwrite");
    const store = tx.objectStore("agendaSlots");
    store.delete(slotData.id);
    tx.oncomplete = ()=>{ renderSlots(); };
  };

  container.appendChild(div);
}

// ===== ADD SLOT BARU =====
function addSlot(){
  if(!currentDate) return alert("Pilih tanggal dulu!");
  const tx = db.transaction("agendaSlots","readwrite");
  const store = tx.objectStore("agendaSlots");
  const newSlot = {date:currentDate, title:"", notes:"", time:""};
  const req = store.add(newSlot);
  req.onsuccess = ()=>{
    renderSlots();
  };
}

// ===== SAVE SLOT =====
function saveSlot(slot){
  const tx = db.transaction("agendaSlots","readwrite");
  const store = tx.objectStore("agendaSlots");
  store.put(slot);
  tx.oncomplete = ()=>{
    alert("Slot tersimpan âœ”");
    renderSlots();
  };
}
</script>

</body>
</html>
